import{_ as k,r as p,o as s,c as n,b as m,a as t,g as f,k as y,t as e,F as _,e as g,n as I,f as T,l as x}from"./index-a63ab4b4.js";import{M as V,P as L}from"./bootstrap.esm-aae09719.js";const E={data(){return{isActive:null,isLoading:!1,fullPage:!0,modal:{},modalData:{},user:{},isPaid:!1}},inject:["VITE_API","VITE_API_PATH","filterDate"],props:["modalFor","orderTemp","getOrdersAll"],watch:{orderTemp:{handler:function(){this.user=this.orderTemp.user,this.isPaid=this.orderTemp.is_paid},deep:!0}},methods:{delOrder(o){this.isLoading=!0,this.$http.delete(`${this.VITE_API}api/${this.VITE_API_PATH}/admin/order/${o}`).then(a=>{a.data.success&&(alert(a.data.message),this.close(),this.getOrdersAll()),this.isLoading=!1})},open(){this.modal.show()},close(){this.modal.hide()}},mounted(){this.modal=new V(this.$refs.productModal)}},w={class:"modal fade",id:"staticBackdrop","data-bs-backdrop":"static","data-bs-keyboard":"false",tabindex:"-1","aria-labelledby":"staticBackdropLabel","aria-hidden":"true",ref:"productModal"},C={class:"modal-dialog modal-lg"},O={class:"modal-content"},D=t("div",{class:"modal-header"},[t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),M={class:"modal-body"},$=t("h4",{class:"my-1 text-center"},"購買人資料",-1),F={class:"table"},H=t("th",{style:{width:"100px"}},"姓名",-1),B=t("th",null,"Email",-1),S=t("th",null,"電話",-1),q=t("th",null,"地址",-1),N=t("h4",{class:"my-1 text-center"},"購物明細",-1),j={class:"table"},z=t("th",{style:{width:"100px"}},"訂單編號",-1),U=t("th",null,"下單時間",-1),G=t("th",null,"付款時間",-1),J={key:0},K={key:1},Q=t("th",null,"付款狀態",-1),R={key:0,class:"text-success"},W={key:1,class:"text-muted"},X=t("th",null,"總金額",-1),Y=t("h4",{class:"my-1 text-center"},"購買商品",-1),Z={class:"table"},tt={class:"text-end"},et={class:"modal-dialog modal-lg"},lt={class:"modal-content"},st=t("div",{class:"modal-header"},[t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),nt={class:"modal-body"},ot=t("h4",{class:"my-1 text-center"},"確定刪除?",-1),dt={class:"table"},at=t("th",{style:{width:"100px"}},"姓名",-1),it=t("th",null,"Email",-1),rt=t("th",null,"電話",-1),ct=t("th",null,"地址",-1),ut={class:"table"},_t=t("th",{style:{width:"100px"}},"訂單編號",-1),ht=t("th",null,"下單時間",-1),pt=t("th",null,"付款時間",-1),mt={key:0},gt={key:1},bt=t("th",null,"付款狀態",-1),ft={key:0,class:"text-success"},yt={key:1,class:"text-muted"},Tt=t("th",null,"總金額",-1),kt={class:"table"},vt={class:"text-end"},At={class:"text-end"};function Pt(o,a,l,h,d,r){const b=p("VueLoading");return s(),n(_,null,[m(b,{active:d.isLoading,"is-full-page":d.fullPage},null,8,["active","is-full-page"]),t("div",w,[f(t("div",C,[t("div",O,[D,t("div",M,[t("div",null,[$,t("table",F,[t("tbody",null,[t("tr",null,[H,t("td",null,e(d.user.name),1)]),t("tr",null,[B,t("td",null,e(d.user.email),1)]),t("tr",null,[S,t("td",null,e(d.user.tel),1)]),t("tr",null,[q,t("td",null,e(d.user.address),1)])])])]),t("div",null,[N,t("table",j,[t("tbody",null,[t("tr",null,[z,t("td",null,e(l.orderTemp.id),1)]),t("tr",null,[U,t("td",null,e(r.filterDate(l.orderTemp.create_at)),1)]),t("tr",null,[G,t("td",null,[l.orderTemp.paid_date?(s(),n("span",J,e(r.filterDate(l.orderTemp.paid_date)),1)):(s(),n("span",K,"尚未付款"))])]),t("tr",null,[Q,t("td",null,[l.orderTemp.is_paid?(s(),n("strong",R,"已付款")):(s(),n("span",W,"尚未付款"))])]),t("tr",null,[X,t("td",null,"$"+e(l.orderTemp.total),1)])])])]),t("div",null,[Y,t("table",Z,[t("tbody",null,[(s(!0),n(_,null,g(l.orderTemp.products,c=>(s(),n("tr",{key:c.id},[t("th",null,e(c.product.title),1),t("td",null,e(c.qty)+" / "+e(c.product.unit),1),t("td",tt,"$"+e(c.final_total),1)]))),128))])])])])])],512),[[y,l.modalFor=="view"]]),f(t("div",et,[t("div",lt,[st,t("div",nt,[t("div",null,[ot,t("div",null,[t("table",dt,[t("tbody",null,[t("tr",null,[at,t("td",null,e(d.user.name),1)]),t("tr",null,[it,t("td",null,e(d.user.email),1)]),t("tr",null,[rt,t("td",null,e(d.user.tel),1)]),t("tr",null,[ct,t("td",null,e(d.user.address),1)])])])]),t("div",null,[t("table",ut,[t("tbody",null,[t("tr",null,[_t,t("td",null,e(l.orderTemp.id),1)]),t("tr",null,[ht,t("td",null,e(r.filterDate(l.orderTemp.create_at)),1)]),t("tr",null,[pt,t("td",null,[l.orderTemp.paid_date!==null&&l.orderTemp.is_paid?(s(),n("span",mt,e(r.filterDate(l.orderTemp.paid_date)),1)):(s(),n("span",gt,"尚未付款"))])]),t("tr",null,[bt,t("td",null,[l.orderTemp.is_paid?(s(),n("strong",ft,"已付款")):(s(),n("span",yt,"尚未付款"))])]),t("tr",null,[Tt,t("td",null,"$"+e(l.orderTemp.total),1)])])])]),t("div",null,[t("table",kt,[t("tbody",null,[(s(!0),n(_,null,g(l.orderTemp.products,c=>(s(),n("tr",{key:c.id},[t("th",null,e(c.product.title),1),t("td",null,e(c.qty)+" / "+e(c.product.unit),1),t("td",vt,"$"+e(c.final_total),1)]))),128))])])])]),t("div",At,[t("button",{type:"button",class:"btn btn-danger",onClick:a[0]||(a[0]=c=>r.delOrder(l.orderTemp.id))}," 刪除 ")])])])],512),[[y,l.modalFor=="del"]])],512)],64)}const It=k(E,[["render",Pt]]),xt={data(){return{isActive:null,isLoading:!0,fullPage:!0,pagination:{},orders:[],modalFor:null,orderTemp:{}}},inject:["VITE_API","VITE_API_PATH","filterDate"],mounted(){this.isLogin(),this.getOrdersAll()},methods:{openModal(o,a){this.modalFor=o,this.orderTemp=a,this.$refs.orderTemp.open()},delAll(){this.isLoading=!0,this.$http.delete(`${this.VITE_API}api/${this.VITE_API_PATH}/admin/orders/all`).then(o=>{o.data.success&&(alert(o.data.message),this.getOrdersAll()),this.isLoading=!1}).catch(o=>console.log(o))},updatePaid(o){this.isLoading=!0;const a=o.id,l={data:{paid_date:o.is_paid?parseInt(Date.now()/1e3):null,is_paid:o.is_paid}};console.log(l),this.$http.put(`${this.VITE_API}api/${this.VITE_API_PATH}/admin/order/${a}`,l).then(h=>{h.data.success&&(alert(h.data.message),this.getOrdersAll()),this.isLoading=!1}).catch(h=>console.log(h))},isLogin(){const o=document.cookie.replace(/(?:(?:^|.*;\s*)petsHome\s*\=\s*([^;]*).*$)|^.*$/,"$1");this.$http.defaults.headers.common.Authorization=o;const a=`${this.VITE_API}api/user/check`;this.$http.post(a).then(()=>{}).catch(()=>{this.$router.push("/login")})},getOrdersAll(){this.isLoading=!0,this.$http(`${this.VITE_API}api/${this.VITE_API_PATH}/admin/orders`).then(o=>{const a=o.data.orders;this.orders=a,this.isLoading=!1,this.pagination=o.data.pagination})}},components:{Pagination:L,OrdersModal:It}},Vt={class:"text-end"},Lt={class:"table mt-4"},Et=t("thead",null,[t("tr",null,[t("th",null,"購買時間"),t("th",null,"Email"),t("th",null,"購買款項"),t("th",null,"應付金額"),t("th",null,"是否付款"),t("th",null,"編輯")])],-1),wt=["textContent"],Ct={class:"list-unstyled"},Ot={class:"text-right"},Dt={class:"form-check form-switch"},Mt=["id","onUpdate:modelValue","onChange"],$t=["for"],Ft={key:0},Ht={key:1},Bt={class:"btn-group"},St=["onClick"],qt=["onClick"];function Nt(o,a,l,h,d,r){const b=p("VueLoading"),c=p("OrdersModal"),v=p("Pagination");return s(),n(_,null,[m(b,{active:d.isLoading,"is-full-page":d.fullPage},null,8,["active","is-full-page"]),t("div",Vt,[t("button",{class:"btn btn-danger btn-sm",type:"button",onClick:a[0]||(a[0]=(...i)=>r.delAll&&r.delAll(...i))}," 刪除全部訂單 ")]),t("table",Lt,[Et,t("tbody",null,[(s(!0),n(_,null,g(d.orders,(i,A)=>(s(),n(_,{key:A},[d.orders.length?(s(),n("tr",{key:0,class:I({"text-secondary":!i.is_paid})},[t("td",null,e(r.filterDate(i.create_at)),1),t("td",null,[i.user?(s(),n("span",{key:0,textContent:e(i.user.email)},null,8,wt)):T("",!0)]),t("td",null,[t("ul",Ct,[(s(!0),n(_,null,g(i.products,(u,P)=>(s(),n("li",{key:P},e(u.product.title)+" 數量："+e(u.qty)+" "+e(u.product.unit),1))),128))])]),t("td",Ot,e(i.total),1),t("td",null,[t("div",Dt,[f(t("input",{class:"form-check-input",type:"checkbox",id:`paidSwitch${i.id}`,"onUpdate:modelValue":u=>i.is_paid=u,onChange:u=>r.updatePaid(i)},null,40,Mt),[[x,i.is_paid]]),t("label",{class:"form-check-label",for:`paidSwitch${i.id}`},[i.is_paid?(s(),n("span",Ft,"已付款")):(s(),n("span",Ht,"未付款"))],8,$t)])]),t("td",null,[t("div",Bt,[t("button",{class:"btn btn-outline-primary btn-sm",type:"button",onClick:u=>r.openModal("view",i)}," 檢視 ",8,St),t("button",{class:"btn btn-outline-danger btn-sm",type:"button",onClick:u=>r.openModal("del",i)}," 刪除 ",8,qt)])])],2)):T("",!0)],64))),128))])]),m(c,{ref:"orderTemp","modal-for":d.modalFor,"order-temp":d.orderTemp,"get-orders-all":r.getOrdersAll},null,8,["modal-for","order-temp","get-orders-all"]),m(v,{pagination:d.pagination,"get-orders-all":r.getOrdersAll},null,8,["pagination","get-orders-all"])],64)}const Ut=k(xt,[["render",Nt]]);export{Ut as default};
