import{M as w,P as M}from"./bootstrap.esm-be01d7e2.js";import{_ as U,o as c,c as n,g as u,k as D,a as t,h as p,l as E,F as A,e as x,f as T,t as r,r as g,b as v,d as f,n as y}from"./index-fffa9242.js";const{VITE_API:P,VITE_API_PATH:I}={VITE_API:"https://vue3-course-api.hexschool.io/v2/",VITE_API_PATH:"petshome",BASE_URL:"/vite-homework/",MODE:"production",DEV:!1,PROD:!0},C={data(){return{modal:{},insertImgBtn:"insert",modalData:{}}},props:["modalFor","productTemp","getProductAll","pagination"],watch:{productTemp:{handler:function(l){this.modalData=this.productTemp,Object.keys(this.productTemp).includes("imagesUrl")&&(this.insertImgBtn=l.imagesUrl[l.imagesUrl.length-1]!==""?"insert":"delete"),this.modalData.is_enabled=this.modalData.is_enabled?1:0},deep:!0}},methods:{open(){this.modal.show()},close(){this.modal.hide()},excute(){const o=!Object.values(this.productTemp).includes(""),i=this.modalFor==="new"?`${P}api/${I}/admin/product`:`${P}api/${I}/admin/product/${this.modalData.id}`;let m="";if(this.modalFor==="new"?m="post":this.modalFor==="edit"?m="put":this.modalFor==="del"&&(m="delete"),this.modalFor=="new"||this.modalFor=="edit")if(!o)alert("請將欄位填寫完畢");else{const e={data:this.modalData};this.$http[m](i,e).then(()=>{this.modalData={},this.getProductAll(this.pagination.current_page),this.close()}).catch(d=>console.log(d))}else this.$http[m](i).then(()=>{this.modalData={},this.getProductAll(this.pagination.current_page),this.close()}).catch(e=>console.log(e))}},mounted(){this.modal=new w(this.$refs.productModal)}},F={class:"modal fade",ref:"productModal","data-bs-backdrop":"static","data-bs-keyboard":"false",tabindex:"-1","aria-labelledby":"staticBackdropLabel","aria-hidden":"true",id:"product-modal-temp"},L={class:"modal-dialog modal-xl"},O={class:"modal-content"},B=t("div",{class:"modal-header"},[t("h5",{class:"modal-title",id:"exampleModalLabel"},"產品規格"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),j={class:"modal-body"},q={class:"row g-3 needs-validation",novalidate:""},N={class:"d-flex flex-wrap"},S={class:"col-12 col-sm-7 pe-3"},H={class:"mb-3"},J=t("label",{for:"product-title",class:"form-label"},"產品標題",-1),R={class:"row g-2 flex-wrap"},z={class:"col-12 col-sm-6 mb-3"},G=t("label",{for:"product-category",class:"form-label"},"產品分類",-1),K={class:"col-12 col-sm-6 mb-3"},Q=t("label",{for:"product-unit",class:"form-label"},"產品單位",-1),W={class:"col-12 col-sm-6 mb-3"},X=t("label",{for:"product-origin-price",class:"form-label"},"產品原價",-1),Y={class:"col-12 col-sm-6 mb-3"},Z=t("label",{for:"product-price",class:"form-label"},"產品售價",-1),$=t("hr",null,null,-1),tt={class:"mb-3"},et=t("label",{for:"product-description",class:"form-label"},"產品描述",-1),ot={class:"mb-3"},st=t("label",{for:"product-content",class:"form-label"},"產品說明內容",-1),lt={class:"mb-3"},it={class:"form-check"},ct=["checked"],nt=t("label",{class:"form-check-label",for:"product-enable"}," 產品啟用 ",-1),dt={class:"col-12 col-sm-5 ps-3"},at={class:"mb-5"},rt=t("label",{for:"imageUrl",class:"form-label"},"主圖網址",-1),ut=["src"],mt=t("h3",{class:"mt-3 mb-2"},"多圖新增",-1),pt={class:""},ht={key:0},_t=["onUpdate:modelValue"],bt=["src"],gt={class:"text-center mt-2 d-grid"},vt={class:"text-center mt-5 d-grid"},ft={key:0},yt={key:1},At={class:"modal-dialog",role:"document"},xt={class:"modal-content"},kt=t("div",{class:"modal-header"},[t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),Dt={class:"modal-body"},Pt={class:"modal-title text-center",id:"exampleModalLabel"},It={class:"d-flex justify-content-center my-4"},Vt=t("button",{type:"button",class:"btn btn-secondary mx-2","data-bs-dismiss":"modal","aria-label":"Close"}," 取消 ",-1);function Ut(l,o,i,m,e,d){return c(),n("div",F,[u(t("div",L,[t("div",O,[B,t("div",j,[t("form",q,[t("div",N,[t("div",S,[t("div",H,[J,u(t("input",{type:"text",class:"form-control",id:"product-title","onUpdate:modelValue":o[0]||(o[0]=s=>e.modalData.title=s),placeholder:"請輸入產品標題",required:""},null,512),[[p,e.modalData.title,void 0,{trim:!0}]])]),t("div",R,[t("div",z,[G,u(t("input",{type:"text",class:"form-control",id:"product-category","onUpdate:modelValue":o[1]||(o[1]=s=>e.modalData.category=s),placeholder:"請輸入產品分類",required:""},null,512),[[p,e.modalData.category,void 0,{trim:!0}]])]),t("div",K,[Q,u(t("input",{type:"text",class:"form-control",id:"product-unit","onUpdate:modelValue":o[2]||(o[2]=s=>e.modalData.unit=s),placeholder:"請輸入產品單位",required:""},null,512),[[p,e.modalData.unit,void 0,{trim:!0}]])]),t("div",W,[X,u(t("input",{type:"number",class:"form-control",id:"product-origin-price","onUpdate:modelValue":o[3]||(o[3]=s=>e.modalData.origin_price=s),placeholder:"請輸入產品原價",required:""},null,512),[[p,e.modalData.origin_price,void 0,{number:!0}]])]),t("div",Y,[Z,u(t("input",{type:"number",class:"form-control",id:"product-price","onUpdate:modelValue":o[4]||(o[4]=s=>e.modalData.price=s),placeholder:"請輸入產品售價",required:""},null,512),[[p,e.modalData.price,void 0,{number:!0}]])])]),$,t("div",tt,[et,u(t("textarea",{class:"form-control",id:"product-description","onUpdate:modelValue":o[5]||(o[5]=s=>e.modalData.description=s),placeholder:"請輸入產品描述",required:""},null,512),[[p,e.modalData.description,void 0,{trim:!0}]])]),t("div",ot,[st,u(t("textarea",{class:"form-control",id:"product-content","onUpdate:modelValue":o[6]||(o[6]=s=>e.modalData.content=s),placeholder:"請輸入產品說明內容",required:""},null,512),[[p,e.modalData.content,void 0,{trim:!0}]])]),t("div",lt,[t("div",it,[u(t("input",{class:"form-check-input",type:"checkbox",id:"product-enable","onUpdate:modelValue":o[7]||(o[7]=s=>e.modalData.is_enabled=s),checked:e.modalData.is_enabled==1},null,8,ct),[[E,e.modalData.is_enabled]]),nt])])]),t("div",dt,[t("div",at,[rt,u(t("input",{type:"text",class:"form-control",id:"imageUrl",placeholder:"請輸入主圖網址","onUpdate:modelValue":o[8]||(o[8]=s=>e.modalData.imageUrl=s),required:""},null,512),[[p,e.modalData.imageUrl]]),t("img",{class:"img-fluid",src:e.modalData.imageUrl},null,8,ut)]),mt,t("div",pt,[Array.isArray(e.modalData.imagesUrl)&&Object.keys(i.productTemp).includes("imagesUrl")?(c(),n("div",ht,[(c(!0),n(A,null,x(e.modalData.imagesUrl,(s,h)=>(c(),n("div",{key:h},[u(t("input",{type:"text",class:"form-control",placeholder:"請輸入圖片網址","onUpdate:modelValue":b=>e.modalData.imagesUrl[h]=b},null,8,_t),[[p,e.modalData.imagesUrl[h]]]),t("img",{class:"img-fluid",src:s},null,8,bt)]))),128))])):T("",!0),t("div",gt,[e.insertImgBtn=="insert"?(c(),n("button",{key:0,type:"button",class:"btn btn-outline-secondary",onClick:o[9]||(o[9]=s=>l.switchImgBtn("delete"))}," + ")):(c(),n("button",{key:1,type:"button",class:"btn btn-outline-danger",onClick:o[10]||(o[10]=s=>l.switchImgBtn("insert"))}," - "))]),t("div",vt,[t("button",{type:"button",class:"btn btn-danger",onClick:o[11]||(o[11]=(...s)=>d.excute&&d.excute(...s))},[i.modalFor==="new"?(c(),n("span",ft,"建立新產品")):(c(),n("span",yt,"更新產品"))])])])])])])])])],512),[[D,i.modalFor=="new"||i.modalFor=="edit"]]),u(t("div",At,[t("div",xt,[kt,t("div",Dt,[t("h5",Pt," 確定要刪除 "+r(e.modalData.title)+" 嗎? ",1),t("div",It,[t("button",{type:"button",class:"btn btn-outline-danger mx-2",onClick:o[12]||(o[12]=(...s)=>d.excute&&d.excute(...s))}," 確定刪除 "),Vt])])])],512),[[D,i.modalFor=="del"]])],512)}const Tt=U(C,[["render",Ut]]),{VITE_API:V,VITE_API_PATH:wt}={VITE_API:"https://vue3-course-api.hexschool.io/v2/",VITE_API_PATH:"petshome",BASE_URL:"/vite-homework/",MODE:"production",DEV:!1,PROD:!0},Mt={data(){return{products:[],isActive:null,isLoading:!0,fullPage:!0,modalFor:null,productTemp:{},pagination:{}}},mounted(){this.isLogin(),this.getProductAll()},methods:{openModal(l,o){this.modalFor=l,l=="new"?this.productTemp={}:l=="edit"?this.products.forEach((i,m)=>{i.id===o&&(this.productTemp=JSON.parse(JSON.stringify(this.products[m])))}):this.products.forEach((i,m)=>{i.id===o&&(this.productTemp=JSON.parse(JSON.stringify(this.products[m])))}),console.log(this.$refs.productModal),this.$refs.productModal.open()},toInitIsActive(l){this.isActive=l},getProductAll(l=1){this.isLoading=!0;const o=`${V}api/${wt}/admin/products/?page=${l}`;this.$http.get(o).then(i=>{this.products=Object.values(i.data.products),this.pagination=i.data.pagination,this.isLoading=!1}).catch(i=>console.log(i))},productDetail(l){this.isActive=l},isLogin(){const l=document.cookie.replace(/(?:(?:^|.*;\s*)petsHome\s*\=\s*([^;]*).*$)|^.*$/,"$1");this.$http.defaults.headers.common.Authorization=l;const o=`${V}api/user/check`;this.$http.post(o).then(()=>{}).catch(()=>{this.$router.push("/login")})}},components:{Pagination:M,ProductModal:Tt}},Et={key:0,class:"col-12 col-sm-5 col-lg-5 p-3"},Ct={class:"card p-3"},Ft={class:"d-flex"},Lt={class:"col-4"},Ot=["src"],Bt={class:"col-8"},jt=["src"],qt={class:"card-body"},Nt={class:"card-title"},St={class:"badge bg-primary"},Ht={class:"card-text"},Jt={class:"card-text"},Rt={class:"card-text"},zt={class:"fs-2 fw-bold fst-italic text-danger me-2"},Gt={class:"text-secondary text-decoration-line-through"},Kt={key:1,class:"col-12 col-sm-5 col-lg-5 p-3"},Qt=t("h3",{class:"text-center"},"請選擇商品",-1),Wt=[Qt],Xt={class:"col-12 col-sm-7 col-lg-6"},Yt={class:"text-end my-4"},Zt={class:"table table-hover"},$t=t("thead",null,[t("tr",null,[t("th",{scope:"col"},"產品名稱"),t("th",{scope:"col"},"原價"),t("th",{scope:"col"},"售價"),t("th",{scope:"col"},"是否啟用"),t("th",{scope:"col"},"查看細節"),t("th",{scope:"col"})])],-1),te={key:0},ee=["onClick","disabled"],oe={class:"d-grid gap-2 d-md-block"},se=["onClick"],le=["onClick"];function ie(l,o,i,m,e,d){const s=g("VueLoading"),h=g("ProductModal"),b=g("Pagination");return c(),n("div",null,[v(s,{active:e.isLoading,"onUpdate:active":o[0]||(o[0]=a=>e.isLoading=a),"can-cancel":!1,"is-full-page":e.fullPage},null,8,["active","is-full-page"]),t("div",{class:y(["d-flex justify-content-center flex-wrap-reverse",{"align-items-center":e.isActive==null}])},[e.products.length>0&&e.isActive!==null?(c(),n("div",Et,[t("div",Ct,[t("div",Ft,[t("div",Lt,[(c(!0),n(A,null,x(e.products[e.isActive].imagesUrl,a=>(c(),n("div",{class:"col-12 mb-2 pe-1 pe-sm-2 pe-lg-3",key:a},[t("img",{src:a,class:"card-img-top primary-image",alt:"..."},null,8,Ot)]))),128))]),t("div",Bt,[t("img",{src:e.products[e.isActive].imageUrl,class:"card-img-top primary-image",alt:"..."},null,8,jt)])]),t("div",qt,[t("h5",Nt,[f(r(e.products[e.isActive].title)+" ",1),t("span",St,r(e.products[e.isActive].category),1)]),t("p",Ht,r(e.products[e.isActive].description),1),t("p",Jt,r(e.products[e.isActive].content),1),t("p",Rt,[f(" 售價： "),t("span",zt,"$"+r(e.products[e.isActive].price),1),t("span",Gt,"$"+r(e.products[e.isActive].origin_price),1),f(" "+r(e.products[e.isActive].unit)+"/元 ",1)])])])])):(c(),n("div",Kt,Wt)),t("div",Xt,[t("div",Yt,[t("button",{type:"button",class:"btn btn-primary",onClick:o[1]||(o[1]=a=>d.openModal("new"))}," 新增產品 ")]),t("table",Zt,[$t,e.products.length>0?(c(),n("tbody",te,[(c(!0),n(A,null,x(e.products,(a,_)=>(c(),n("tr",{key:a.id},[t("td",null,r(a.title),1),t("td",null,"$"+r(a.origin_price),1),t("td",null,"$"+r(a.price),1),t("td",{class:y({"text-success":a.is_enabled>0})},r(a.is_enabled>0?"啟用":"未啟用"),3),t("td",null,[t("button",{type:"button",class:y(["btn btn-secondary",{"btn-success":e.isActive==_}]),onClick:k=>d.productDetail(_),disabled:e.isActive==_},r(e.isActive==_?"正在查看":"查看細節"),11,ee)]),t("td",null,[t("div",oe,[t("button",{type:"button",class:"btn btn-outline-secondary btn-sm",onClick:k=>d.openModal("edit",a.id)}," 編輯 ",8,se),t("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:k=>d.openModal("del",a.id)}," 刪除 ",8,le)])])]))),128))])):T("",!0)]),t("p",null,"目前有 "+r(e.products.length)+" 項產品",1),v(h,{"modal-for":e.modalFor,"product-temp":e.productTemp,"get-product-all":d.getProductAll,pagination:e.pagination,ref:"productModal"},null,8,["modal-for","product-temp","get-product-all","pagination"]),v(b,{pagination:e.pagination,"get-product-all":d.getProductAll,onInitIsActive:d.toInitIsActive},null,8,["pagination","get-product-all","onInitIsActive"])])],2)])}const de=U(Mt,[["render",ie]]);export{de as default};
